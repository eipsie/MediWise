# AI医疗诊断辅助系统需求规格说明书

**版本：** V1.2  
**更新日期：** 2025-06-15  
**项目代码：** MEDICAL-AI-001  
**技术栈：** Spring Boot + Vue3 + MySQL + Redis

---

## 1. 项目概述

### 1.1 系统定位
AI医疗诊断辅助系统旨在通过人工智能技术辅助医生进行疾病诊断，提高诊断效率和准确性。系统基于Spring Boot后端和Vue3前端，支持患者管理、AI辅助诊断、处方管理、血常规分析等功能。

### 1.2 用户角色
- **医生**：系统主要用户，负责患者诊疗和处方开具
- **管理员**：负责系统配置和用户管理

### 1.3 技术环境
- **后端**：Spring Boot 2.7.x, MyBatis Plus, Redis
- **前端**：Vue 3, Element Plus, TypeScript
- **数据库**：MySQL 8.0+
- **部署**：Docker容器化部署
- **AI服务**：Python Flask/FastAPI

---

## 2. 功能需求

### 2.1 用户管理模块

#### 2.1.1 账户管理
- 医生和管理员账户的注册、登录、信息维护
- 基于角色的权限控制（管理员/医生）
- 密码MD5加密存储
- 登录日志记录

### 2.2 患者信息管理模块

#### 2.2.1 患者档案管理
- 创建、查询、修改患者基本信息
- 记录患者过敏史、既往病史
- 多条件组合检索患者信息

### 2.3 AI诊断核心模块

#### 2.3.1 症状信息录入
- 结构化症状选择器：提供常见症状的分类选择树（如呼吸系统、消化系统等）
- 自由文本症状描述：支持医生输入详细症状描述，系统通过NLP技术提取关键信息
- 检查结果数据关联：可关联血常规、影像学检查等结果，提高诊断准确性
- 历史症状比对：显示患者历史就诊症状，便于医生分析病情变化

#### 2.3.2 AI诊断推理
- 症状数据标准化处理：将自由文本和结构化症状统一转换为标准医学术语
- 多模型融合推理：结合规则引擎和深度学习模型进行综合分析
- 提供疾病概率排序：按置信度降序排列可能的疾病，并标注是否为危急重症
- 诊断依据透明化：清晰展示每个诊断结论的症状匹配点和参考依据

```json
// AI诊断结果格式示例
{
  "diagnoses": [
    {
      "disease_name": "疾病名称",
      "disease_code": "ICD-10编码",
      "confidence": 0.85,
      "symptoms_match": ["匹配症状列表"],
      "recommendations": "进一步检查建议"
    }
  ],
  "risk_factors": ["风险因素列表"],
  "suggested_tests": ["建议检查项目"]
}
```

#### 2.3.3 诊断结果确认
- 医生确认或修改AI诊断建议
- 生成最终诊断报告

### 2.4 处方管理模块

#### 2.4.1 电子处方开具
- 基于诊断结果开具处方
- 药品名称、规格、剂量等信息管理

#### 2.4.2 处方合理性检查
- 药物禁忌症检查
- 药物相互作用分析
- 患者过敏史匹配

### 2.5 医学知识库模块

#### 2.5.1 疾病知识管理
- 疾病基本信息和分类
- 典型症状和体征
- 诊断标准和治疗指南

#### 2.5.2 知识库检索
- 疾病名称检索
- 症状反向查询
- 治疗指南浏览

### 2.6 血常规分析模块

#### 2.6.1 血常规数据管理
- 手动录入界面：直观的表单布局，带有参考范围提示
- 批量导入功能：支持Excel/CSV格式的检验报告导入，自动识别字段映射
- 历史数据查询：按时间轴展示患者历次检查结果，支持多次检查数据对比
- 异常值标记：自动标记超出正常参考范围的指标，分级显示异常程度

#### 2.6.2 AI血常规分析
- 无监督聚类分析：使用K-means或DBSCAN算法识别异常血常规模式
- 监督学习模型：基于已标记数据训练的分类模型，预测可能的疾病类型
- 异常指标组合分析：识别多项指标异常的组合模式及其临床意义
- 模型解释性展示：通过特征重要性分析，解释模型决策依据

#### 2.6.3 分析结果展示
- 交互式仪表盘：直观展示各项指标及其异常程度
- 多维度图表：支持折线图、雷达图等多种可视化方式
- 相似病例参考：展示系统中与当前血常规模式相似的历史病例（匿名化）
- PDF报告生成：一键生成规范化的血常规分析报告，支持打印和电子签名

---

## 3. 非功能需求

### 3.1 性能需求
- 用户登录响应时间 ≤ 2秒
- AI诊断计算响应时间 ≤ 3秒
- 支持100名医生同时在线
- 系统可用性 ≥ 99.5%
- 数据库支持50万患者档案

### 3.2 安全需求
- 敏感数据加密存储
- HTTPS传输加密
- 操作审计日志
- SQL注入防护
- XSS和CSRF防护

### 3.3 可靠性需求
- 系统故障自动报警
- 数据库定期备份
- 关键服务自动重启

---

## 4. 接口规范

### 4.1 内部API接口

#### 4.1.1 RESTful API设计规范
```
GET    /api/patients          # 获取患者列表
POST   /api/patients          # 创建新患者
GET    /api/patients/{id}     # 获取特定患者
PUT    /api/patients/{id}     # 更新患者信息
DELETE /api/patients/{id}     # 删除患者
```

#### 4.1.2 统一响应格式
```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": "2025-05-28T10:30:00Z"
}
```

### 4.2 外部服务接口

#### 4.2.1 AI诊断服务接口
```http
POST /api/diagnosis
Content-Type: application/json
Authorization: Bearer {token}

{
  "patient_id": "P20250528001",
  "symptoms": ["发热", "咳嗽", "乏力"],
  "vital_signs": {
    "temperature": 38.5,
    "blood_pressure": "120/80",
    "heart_rate": 90
  },
  "lab_results": {
    "white_blood_cell": 12000,
    "c_reactive_protein": 15
  }
}
```

#### 4.2.2 血常规分析服务接口
```http
POST /api/blood-analysis
Content-Type: application/json
Authorization: Bearer {token}

{
  "WBC": 35.8,
  "LYMp": 15.0,
  "MIDp": 6.0,
  "NEUTp": 79.0,
  "LYMn": 5.4,
  "MIDn": 2.1,
  "NEUTn": 28.3,
  "RBC": 2.8,
  "HGB": 80,
  "HCT": 28,
  "MCV": 100.0,
  "MCH": 28.6,
  "MCHC": 286,
  "RDWSD": 60.0,
  "RDWCV": 18.0,
  "PLT": 60,
  "MPV": 10.5,
  "PDW": 15.0,
  "PCT": 0.063,
  "PLCR": 35.0
}
```

---

## 5. 数据模型

### 5.1 实体关系图
```
医生(Doctor) ——1:N—— 诊断记录(DiagnosisRecord)
患者(Patient) ——1:N—— 诊断记录(DiagnosisRecord)
患者(Patient) ——1:N—— 血常规检查(BloodTest)
诊断记录(DiagnosisRecord) ——1:N—— 处方(Prescription)
诊断记录(DiagnosisRecord) ——1:N—— 医疗文件(MedicalFile)
诊断记录(DiagnosisRecord) ——1:N—— 血常规检查(BloodTest)
患者(Patient) ——1:N—— 医疗文件(MedicalFile)
医学知识库(MedicalKnowledge) —— 支撑 —— AI诊断算法
```

### 5.2 核心表结构

#### 5.2.1 医生表 (doctor)
| 字段名 | 数据类型 | 说明 |
|--------|----------|------|
| id | BIGINT | 主键ID |
| username | VARCHAR(50) | 登录用户名(唯一) |
| password | VARCHAR(255) | 登录密码(MD5加密) |
| real_name | VARCHAR(100) | 医生真实姓名 |
| status | TINYINT | 状态(1:正常,0:禁用) |
| role | VARCHAR(20) | 角色(doctor:医生,admin:管理员) |
| department | VARCHAR(50) | 所属科室 |
| email | VARCHAR(100) | 电子邮箱 |
| phone | VARCHAR(20) | 联系电话 |

#### 5.2.2 患者表 (patient)
| 字段名 | 数据类型 | 说明 |
|--------|----------|------|
| id | BIGINT | 主键ID |
| patient_id | VARCHAR(50) | 患者编号(唯一) |
| name | VARCHAR(100) | 患者姓名 |
| gender | TINYINT | 性别(1:男,2:女) |
| birth_date | DATE | 出生日期 |
| allergies | TEXT | 过敏史 |
| medical_history | TEXT | 既往病史 |
| phone | VARCHAR(20) | 联系电话 |
| address | TEXT | 联系地址 |
| id_card | VARCHAR(20) | 身份证号 |
| create_time | DATETIME | 创建时间 |

#### 5.2.3 诊断记录表 (diagnosis_record)
| 字段名 | 数据类型 | 说明 |
|--------|----------|------|
| id | BIGINT | 主键ID |
| patient_id | BIGINT | 患者ID(外键) |
| doctor_id | BIGINT | 医生ID(外键) |
| symptoms | TEXT | 患者症状描述 |
| ai_diagnosis | JSON | AI诊断结果JSON |
| final_diagnosis | TEXT | 最终诊断结果 |
| status | VARCHAR(20) | 状态(draft:草稿,final:确诊) |

#### 5.2.4 血常规检查表 (blood_test)
| 字段名 | 数据类型 | 说明 |
|--------|----------|------|
| id | BIGINT | 主键ID |
| patient_id | BIGINT | 患者ID(外键) |
| diagnosis_id | BIGINT | 关联诊断ID(外键) |
| test_date | DATETIME | 检查日期 |
| WBC | DECIMAL(6,2) | 白细胞计数 |
| RBC | DECIMAL(6,2) | 红细胞计数 |
| HGB | DECIMAL(6,2) | 血红蛋白 |
| PLT | DECIMAL(6,2) | 血小板计数 |
| analysis_result | JSON | 机器学习分析结果JSON |

#### 5.2.5 医疗文件表 (medical_file)
| 字段名 | 数据类型 | 说明 |
|--------|----------|------|
| id | BIGINT | 主键ID |
| patient_id | BIGINT | 患者ID(外键) |
| diagnosis_id | BIGINT | 关联诊断ID(外键，可为空) |
| file_name | VARCHAR(255) | 文件名称 |
| file_type | VARCHAR(50) | 文件类型(IMAGE:影像,REPORT:检查报告,OTHER:其他) |
| file_path | VARCHAR(500) | 文件存储路径 |
| file_size | BIGINT | 文件大小(字节) |
| upload_time | DATETIME | 上传时间 |
| description | TEXT | 文件描述 |
| tags | VARCHAR(255) | 文件标签(逗号分隔) |
| status | TINYINT | 状态(1:有效,0:已删除) |

#### 5.2.6 医学知识库表 (medical_knowledge)
| 字段名 | 数据类型 | 说明 |
|--------|----------|------|
| id | BIGINT | 主键ID |
| disease_name | VARCHAR(200) | 疾病名称 |
| disease_code | VARCHAR(50) | ICD-10疾病编码 |
| category | VARCHAR(100) | 疾病分类 |
| description | TEXT | 疾病描述 |
| symptoms | TEXT | 典型症状(JSON格式) |
| diagnosis_criteria | TEXT | 诊断标准 |
| treatment_guide | TEXT | 治疗指南 |
| risk_factors | TEXT | 风险因素 |
| complications | TEXT | 常见并发症 |
| reference | TEXT | 参考文献 |
| last_update | DATETIME | 最后更新时间 |
| status | TINYINT | 状态(1:已审核,0:待审核) |

---

## 6. 技术架构

### 6.1 系统架构图
```
┌───────────────────────────────────────────────────────────────────────┐
│                             客户端层                                   │
│  ┌─────────────────────┐           ┌─────────────────────┐            │
│  │      Web浏览器       │           │      移动设备        │            │
│  └─────────────────────┘           └─────────────────────┘            │
└───────────────────────────────────┬───────────────────────────────────┘
                                   │
┌──────────────────────────────────┴───────────────────────────────────┐
│                             接入层                                    │
│  ┌─────────────────────────────────────────────────────────────────┐ │
│  │                      Nginx负载均衡                               │ │
│  └─────────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────┬───────────────────────────────────┘
                                   │
┌──────────────────────────────────┴───────────────────────────────────┐
│                             应用层                                    │
│  ┌─────────────────────────────────────────────────────────────────┐ │
│  │                    Spring Boot应用集群                           │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │ │
│  │  │  用户模块    │  │  诊断模块     │  │      处方模块            │  │ │
│  │  └─────────────┘  └─────────────┘  └─────────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────┬───────────────────────────────────┘
                                   │
┌──────────────────────────────────┴───────────────────────────────────┐
│                           AI服务层                                    │
│  ┌─────────────────────┐  ┌─────────────────────┐                    │
│  │    诊断推理服务       │  │   血常规分析服务      │                    │
│  │   (Python/FastAPI)  │  │  (Python/Flask)     │                    │
│  └─────────────────────┘  └─────────────────────┘                    │
└──────────────────────────────────┬───────────────────────────────────┘
                                   │
┌──────────────────────────────────┴───────────────────────────────────┐
│                             数据层                                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                   │
│  │ MySQL数据库  │  │ Redis缓存    │  │ MinIO存储   │                   │
│  └─────────────┘  └─────────────┘  └─────────────┘                   │
└───────────────────────────────────────────────────────────────────────┘
```

### 6.2 部署与运维

#### 6.2.1 部署架构
系统采用Docker容器化部署，主要包含以下服务：
- Nginx：负载均衡和静态资源服务
- Spring Boot应用：核心业务逻辑处理
- MySQL：关系型数据存储
- Redis：缓存和会话管理
- Python AI服务：机器学习模型推理服务
- MinIO：医疗文件对象存储

#### 6.2.2 监控与告警
- 应用监控：Spring Boot Actuator + Prometheus + Grafana
- 服务健康检查：定时心跳检测各服务组件状态
- 异常告警：关键错误通过邮件和短信通知运维人员
- 性能监控：CPU、内存、磁盘IO、网络流量等系统指标实时监控

### 6.3 血常规分析模块技术实现

#### 6.3.1 数据处理流程
1. **数据采集**：通过手动录入或Excel导入获取血常规检查数据
2. **数据清洗**：处理缺失值、异常值检测与修正
3. **特征工程**：生成派生特征（如比值特征）、特征标准化
4. **数据存储**：结构化数据存入MySQL，原始报告存入MinIO

#### 6.3.2 机器学习模型实现
1. **无监督学习模型**：
   - 算法选择：K-means聚类、DBSCAN密度聚类
   - 实现技术：scikit-learn库
   - 模型持久化：pickle序列化存储
   - 部署方式：Flask RESTful API服务

2. **监督学习模型**：
   - 算法选择：随机森林、XGBoost
   - 特征选择：递归特征消除(RFE)
   - 超参数优化：网格搜索(GridSearchCV)
   - 模型评估：交叉验证、混淆矩阵、ROC曲线

#### 6.3.3 Java与Python交互
1. **接口调用方式**：RESTful API
2. **数据传输格式**：JSON
3. **接口认证**：JWT令牌认证
4. **异常处理**：统一错误码和重试机制
5. **性能优化**：连接池和请求缓存

#### 6.3.4 前端可视化实现
1. **技术选型**：ECharts图表库
2. **图表类型**：
   - 雷达图：展示多项指标对比
   - 折线图：展示历史趋势
   - 热力图：展示异常指标分布
3. **交互功能**：
   - 时间范围筛选
   - 指标对比选择
   - 缩放与导出

---

## 7. 开发计划

### 7.1 开发阶段
1. **需求分析与设计** (2周)
   - 需求规格说明书编写
   - 数据库设计
   - API接口设计

2. **基础功能开发** (4周)
   - 用户管理模块
   - 患者信息管理模块
   - 前端基础框架

3. **核心功能开发** (6周)
   - AI诊断核心模块
   - 处方管理模块
   - 医学知识库模块

4. **血常规分析功能** (3周)
   - Python机器学习模型开发
   - Java后端集成
   - 前端展示界面

5. **测试与优化** (3周)
   - 单元测试和集成测试
   - 性能优化
   - 安全测试

6. **部署上线** (2周)
   - 环境配置
   - 数据迁移
   - 监控系统搭建

### 7.2 技术关键点
- Spring Boot与Python AI服务的集成：使用RESTful API进行服务间通信，考虑使用gRPC提升性能
- 复杂医学数据的JSON存储与查询：针对JSON字段设计高效索引，优化查询性能
- 前端大量医疗数据的高效展示：采用虚拟滚动和数据分页技术，减轻浏览器负担
- 系统安全性与患者数据保密：实施细粒度的权限控制和数据访问审计
- 机器学习模型的持续优化：建立模型评估反馈机制，基于新数据定期重训练模型

### 7.3 项目风险与应对策略
| 风险点 | 可能影响 | 应对策略 |
|--------|----------|---------|
| AI诊断准确性不足 | 医生对系统信任度降低 | 明确系统辅助性质，保持医生最终决策权；建立模型评估机制 |
| 患者数据安全泄露 | 法律风险和声誉损失 | 实施数据脱敏和访问控制；定期安全审计和渗透测试 |
| 系统性能瓶颈 | 用户体验下降 | 提前进行负载测试；实施缓存策略；准备水平扩展方案 |
| 医生使用意愿低 | 系统推广困难 | 简化操作流程；提供充分培训；收集用户反馈持续改进 |
| 与现有HIS系统集成困难 | 数据孤岛，重复录入 | 预先调研接口规范；设计灵活的适配器模式 |

---

**版本历史**
- V1.0 (2025-05-28): 初始版本
- V1.1 (2025-06-10): 简化用户角色
- V1.2 (2025-06-15): 添加血常规分析功能